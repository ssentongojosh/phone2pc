<!DOCTYPE html>
<html>
  <head>
    <title>Upload File</title>
    <link rel="stylesheet" href="style.css" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <h1>Upload a File</h1>
    <form
      method="POST"
      action="http://192.168.137.1:80"
      enctype="multipart/form-data"
    >
      <input type="file" name="file" />
      <br /><br />
      <input type="submit" value="Upload" />
    </form>

    <div id="folder-structure">
      <h2>Folder Structure (C:\Users\Public)</h2>
      <iframe src="/list_files" width="100%" height="400px"></iframe>
      <!-- Add this button -->
      <ul id="file-list"></ul>
    </div>

    <script>
      const iframe = document.getElementById("file-list-iframe");

      // Function to add event listeners to folder links inside the iframe
      function addFolderLinkListeners() {
        try {
          // Get the content document of the iframe
          const iframeDoc =
            iframe.contentDocument || iframe.contentWindow.document;

          // Find all links with the class 'folder-link'
          const folderLinks = iframeDoc.querySelectorAll(".folder-link");

          // Add click event listener to each folder link
          folderLinks.forEach((link) => {
            link.addEventListener("click", handleFolderClick);
            link.addEventListener("touchend", handleFolderClick); // Add touchend
          });

          function handleFolderClick(event) {
            event.preventDefault(); // Prevent default
            const folderPath = this.dataset.path;
            iframe.src = `/list_files?path=${folderPath}`;
          }
        } catch (error) {
          console.error(
            "Error accessing iframe content or adding listeners:",
            error
          );
          // Handle cases where iframe content might not be accessible (e.g., cross-origin issues, though not expected here)
        }
      }

      // Add event listener to the iframe to detect when its content has loaded
      iframe.addEventListener("load", addFolderLinkListeners);

      // Initial call in case the iframe content is already loaded when the script runs
      if (
        iframe.contentDocument &&
        iframe.contentDocument.readyState === "complete"
      ) {
        addFolderLinkListeners();
      }
    </script>
  </body>
</html>
