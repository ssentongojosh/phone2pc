<!DOCTYPE html>
<html>
  <head>
    <title>Upload File</title>
    <link rel="stylesheet" href="style.css" >
    <meta charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1.0" >
  </head>
  <body>
    <h1>Upload a File</h1>
    <form
      method="POST"
      action="http://192.168.137.1:80"
      enctype="multipart/form-data"
    >
      <input type="file" name="file" />
      <br /><br />
      <input type="submit" value="Upload" />
    </form>

    <div id="folder-structure">
        <h2>Folder Structure (C:\Users\Public)</h2>
        <button id="view-files-button">View Files</button> <!-- Add this button -->
        <ul id="file-list"></ul>
    </div>

    <script>
        async function fetchFileList() {
            try {
                const response = await fetch('/list_files');
                const files = await response.json();
                const fileListElement = document.getElementById('file-list');
                fileListElement.innerHTML = ''; // Clear existing list

                if (files.error) { // Check if the response contains an error
                    const listItem = document.createElement('li');
                    listItem.textContent = `Error: ${files.error}`;
                    fileListElement.appendChild(listItem);
                } else {
                    files.forEach(item => {
                        const listItem = document.createElement('li');
                        // You might want to add icons or differentiate files/folders later
                        // For now, just display the name
                        listItem.textContent = item;
                        fileListElement.appendChild(listItem);
                    });
                }
            } catch (error) {
                console.error('Error fetching file list:', error);
                const fileListElement = document.getElementById('file-list');
                fileListElement.innerHTML = '<li>Error loading file list.</li>';
            }
        }

        // Get the button element
        const viewFilesButton = document.getElementById('view-files-button');

        // Add an event listener to the button
        viewFilesButton.addEventListener('click', fetchFileList);

        // Remove the automatic call to fetchFileList() on page load
        // fetchFileList(); 
    </script>
  </body>
</html>
